<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SultanArtist | Live Mobile Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background: #000; color: #fff; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .sync-font { font-family: 'Syncopate', sans-serif; text-transform: uppercase; letter-spacing: 1px; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .slot { aspect-ratio: 16/9; border-radius: 12px; overflow: hidden; background: #111; border: 1px solid #222; position: relative; transition: transform 0.1s; }
        .slot:active { transform: scale(0.95); }
        .admin-only { display: none; }
        .is-admin .admin-only { display: flex; }
        .live-pulse { width: 8px; height: 8px; background: #10b981; border-radius: 50%; display: inline-block; box-shadow: 0 0 10px #10b981; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        #intro { transition: opacity 0.5s ease; }
    </style>
</head>
<body>

    <div id="intro" class="fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center p-6 text-center">
        <h1 class="sync-font text-2xl mb-8">SULTAN<span class="text-blue-600">ARTIST</span></h1>
        <button onclick="document.getElementById('intro').style.opacity='0';setTimeout(()=>document.getElementById('intro').remove(),500)" class="w-full max-w-xs py-4 bg-blue-600 rounded-xl sync-font text-xs">Enter Vault</button>
    </div>

    <nav class="fixed top-0 inset-x-0 p-4 z-40">
        <div class="glass rounded-2xl p-4 flex justify-between items-center">
            <span class="sync-font text-xs font-bold">Vault <span class="text-blue-600">Live</span></span>
            <div class="flex items-center gap-3">
                <span class="live-pulse"></span>
                <button onclick="showLogin()" class="p-2 glass rounded-lg"><i data-lucide="settings" class="w-4 h-4"></i></button>
            </div>
        </div>
    </nav>

    <main class="pt-24 pb-12 px-4 max-w-md mx-auto">
        <div class="flex justify-between items-end mb-6">
            <h2 class="sync-font text-xl">Thumbnails</h2>
            <span id="count" class="text-blue-500 font-bold text-sm">0/80</span>
        </div>

        <div id="admin-actions" class="admin-only mb-6 flex flex-col gap-2">
            <button onclick="document.getElementById('multi').click()" class="w-full py-6 glass border-blue-600/50 border-2 border-dashed rounded-2xl flex flex-col items-center gap-2">
                <i data-lucide="plus-circle" class="text-blue-500"></i>
                <span class="sync-font text-[10px]">Add Multiple Items</span>
            </button>
        </div>

        <div id="grid" class="grid grid-cols-1 gap-4"></div>
    </main>

    <div id="login-modal" class="fixed inset-0 z-[110] bg-black/90 hidden items-center justify-center p-6">
        <div class="glass p-8 rounded-3xl w-full max-w-xs">
            <input type="password" id="pass" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-center mb-4" placeholder="Admin Key">
            <button onclick="login()" class="w-full py-4 bg-blue-600 rounded-xl sync-font text-xs">Login</button>
            <button onclick="document.getElementById('login-modal').classList.add('hidden')" class="w-full mt-2 py-2 text-xs opacity-50">Cancel</button>
        </div>
    </div>

    <div id="about-modal" class="fixed inset-0 z-[110] bg-black hidden flex-col items-center justify-center p-8 text-center" onclick="this.classList.add('hidden')">
        <h3 class="sync-font text-xl mb-4 text-blue-600">Sultan Artist</h3>
        <p class="text-sm opacity-70 mb-8">Professional Design Strategy.</p>
        <div class="w-full space-y-2">
            <div class="glass p-4 rounded-xl text-xs">IG: @ray_sultanyt</div>
            <div class="glass p-4 rounded-xl text-xs">Discord: sultanthumbnail</div>
        </div>
    </div>

    <input type="file" id="single" class="hidden" accept="image/*">
    <input type="file" id="multi" class="hidden" accept="image/*" multiple>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'sultan-final-mobile';

        let admin = false, vault = {};

        signInAnonymously(auth);
        onAuthStateChanged(auth, u => {
            if(u) onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'v'), (s) => {
                vault = {}; s.forEach(d => vault[d.id] = d.data()); render();
            });
        });

        function render() {
            const g = document.getElementById('grid'); g.innerHTML = '';
            let c = 0;
            for(let i=1; i<=80; i++) {
                const id = `s${i}`, item = vault[id]; if(item) c++;
                const d = document.createElement('div');
                d.className = 'slot';
                d.onclick = () => {
                    if(admin) {
                        const inp = document.getElementById('single');
                        inp.onchange = (e) => { if(e.target.files[0]) up(e.target.files[0], id); };
                        inp.click();
                    } else if(item) {
                        window.open(item.img, '_blank');
                    }
                };
                d.innerHTML = item ? `<img src="${item.img}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center opacity-10 text-[10px] sync-font">${i}</div>`;
                g.appendChild(d);
            }
            document.getElementById('count').innerText = `${c}/80`;
            lucide.createIcons();
        }

        async function up(f, id) {
            const r = new FileReader(); r.readAsDataURL(f);
            r.onload = async e => {
                const img = new Image(); img.src = e.target.result;
                img.onload = async () => {
                    const canvas = document.createElement('canvas'); const s = 1080/img.width;
                    canvas.width = 1080; canvas.height = img.height*s;
                    canvas.getContext('2d').drawImage(img, 0, 0, 1080, canvas.height);
                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'v', id), { img: canvas.toDataURL('image/jpeg', 0.7) });
                }
            }
        }

        window.showLogin = () => document.getElementById('login-modal').classList.remove('hidden');
        window.login = () => {
            if(document.getElementById('pass').value === 'kashaf1211') {
                admin = true; document.body.classList.add('is-admin');
                document.getElementById('login-modal').classList.add('hidden');
                render();
            }
        };
        window.openAbout = () => document.getElementById('about-modal').classList.remove('hidden');

        document.getElementById('multi').onchange = async (e) => {
            const files = Array.from(e.target.files);
            let empty = []; for(let i=1; i<=80; i++) if(!vault[`s${i}`]) empty.push(`s${i}`);
            for(let i=0; i<Math.min(files.length, empty.length); i++) await up(files[i], empty[i]);
        };

        lucide.createIcons();
    </script>
</body>
</html>
